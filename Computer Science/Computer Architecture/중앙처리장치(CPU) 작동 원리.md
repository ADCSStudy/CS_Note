# ****중앙처리장치(CPU) 작동 원리****

## CPU

컴퓨터에서 가장 핵심적인 역할을 수행. '인간의 두뇌'에 해당

- ****연산 장치(산술논리연산장치)****
    - 산술, 논리 연산 수행
    - 연산에 필요한 데이터를 레지스터에서 가져오고, 결과를 다시 레지스터로 보냄
- **제어 장치**
    - 명령어를 순서대로 실행할 수 있도록 제어하는 장치
    - 주기억장치에서 프로그램 명령어를 꺼내 해독하여 필요한 제어 신호를 기억장치, 연산장치, 입출력장치로 보냄
    - 기억장치, 연산장치, 입출력장치가 보낸 신호를 받아 다음 수행할 동작을 결정
- **레지스터**
    - 명령어 주소, 코드, 연산에 필요한 데이터, 연산 결과 등을 임시로 저장하는 고속 기억 장치
    - CPU 종류에 따라 사용할 수 있는 레지스터 개수와 크기가 다름
        - CPU 1회 연산에 처리 가능한 데이터 비트 수 (워드)
    - 용도에 따라 범용 레지스터와 특수목적 레지스터로 구분
        - 범용 레지스터: 연산에 필요한 데이터나 연산 결과를 임시로 저장
        - 특수 목적 레지스터
            - MAR(메모리 주소 레지스터) : 읽기와 쓰기 연산을 수행할 주기억장치 주소 저장
            - PC(프로그램 카운터) : 다음에 수행할 명령어 주소 저장
            - IR(명령어 레지스터) : 현재 실행 중인 명령어 저장
            - MBR(메모리 버퍼 레지스터) : 주기억장치에서 읽어온 데이터 or 저장할 데이터 임시 저장
            - AC(누산기) : 연산 결과 임시 저장
- **명령어 사이클**
    - CPU는 프로그램 실행하기 위해 주기억장치에서 명령어를 순차적으로 인출하여 해독하고 실행하는 과정을 반복
        - 명령어: 연산코드+피연산자
            - 연산코드: 실행할 연산
            - 피연산자: 필요한 데이터 or 저장 위치
    - 한번에 하나의 명령어를 인출하여 실행하는데 필요한 일련의 활동을 '명령어 사이클’
        - 인출 사이클
            - 주기억장치의 지정된 주소에서 수행할 명령어를 CPU로 가져오는 단계
            - 처리 과정
                - PC에 저장된 주소를 MAR로 전달
                - 주기억장치의 해당 주소에서 명령어 인출
                - 인출한 명령어를 MBR에 저장
                - 다음 명령어를 인출하기 위해 PC값 증가시킴
                - MBR에 저장된 내용을 IR에 전달
                
                ```
                T0 : MAR ← PC
                T1 : MBR ← M[MAR], PC ← PC+1
                T2 : IR ← MBR
                ```
                
            - 명령어의 연산 코드가 직접 주소일 경우 실행 사이클로 진행, 아닐 경우 간접 사이클 진행
        - 간접 사이클
            - 명령어의 연산 코드가 간접 주소일 경우 유효주소를 계산하기 위해 주기억장치에 접근하는 단계
                - IR에 전달된 명령어의 주소를 MAR로 전달
                - 기억장치의 해당 주소에 해당하는 값 인출하여 MBR에 저장
                - MBR에 있는 값을 IR로 전달하여 갱신하여 간접 주소가 아니라 직접 주소를 가지게 됨
                
                ```
                T0 : MAR ← IR(addr)
                T1 : MBR ← M[MAR]
                T2 : IR ← MBR
                ```
                
        - 실행 사이클
            - 실제로 명령어를 실행하는 단계
            - 처리  과정
                - 인출이 진행되고 명령어만 실행하면 되기 때문에 PC를 증가할 필요 없음
                - AC에 MBR을 더해주기만 하면 됨
                
                ```
                T0 : MAR ← IR(addr)
                T1 : MBR ← M[MAR]
                T2 : AC ← AC + MBR
                ```
                
        - 인터럽트 사이클
            - 인터럽트 발생시 인터럽트 처리를 위한 단계
            - 완료되면 다시 인출 사이클 진행
            - 처리 과정
                - PC의 내용이 MBR로 보내져서 인터럽트 수행이 끝난 후 복귀(return)할 때 사용가능하도록 함
                - MAR에는 PC의 내용이 저장될 위치의 주소가 적재. PC에는 인터럽트-처리 루틴의 시작주소가 적재
                - PC의 이전 값을 가지고 있는 MBR의 내용을 기억장치에 저장
