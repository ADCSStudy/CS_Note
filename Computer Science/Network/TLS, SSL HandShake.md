# ****TLS/SSL HandShake****

## SSL(Secure Socket Layer)

- 이전에는 웹에서의 데이터는 가로채면 누구나 읽을 수 있는 일반 텍스트 형태로 전송되었다. 인터넷 통신의 개인정보 보호, 인증, 데이터 무결성을 보장하기 위해 개발한 SSL
- 암호화 기반 인터넷 보안 프로토콜로, 전달되는 모든 데이터를 암호화하고 특정한 유형의 사이버 공격을 차단한다.
- 브라우저와 서버 사이(또는 두 서버 사이)에 전송되는 데이터를 암호화하여 인터넷 연결을 보호하기 위한 표준 기술.
- 이를 사용한 웹사이트 URL은 HTTP 대신 HTTPS가 사용된다.
- 1996년 3.0 이후 업데이트되지 않았으며, 앞으로 사라지게 될 것으로 여겨진다. 알려진 여러 취약성이 있으며 보안 전문가들은 사용 중단을 권장. 그 대안으로 나타난 TLS.

## TLS(Transport Layer Security)

- SSL의 업데이트 버전으로 SSL의 최종버전 3.0과 TLS의 최초버전의 차이는 크지 않으며, 이름이 바뀐 것은 SSL을 개발한 사람이 업데이트에 참여하지 않게 되어 소유권 변경을 위해서였다.
- TLS는 SSL의 업데이트 버전이며 명칭만 다르다고 볼 수 있다.
- SSL 암호화로 혼용해서 부르는 경우도 많다. 실제로 현재 SSL을 인증한 업체 및 제공하는 업체는 사실상 TLS 암호화를 제공하고 있는것이다.

## ****SSL/TLS 의 작동 방식****

- SSL은 개인정보 보호를 제공하기 위해, 웹에서 전송되는 데이터를 암호화한다. 따라서, 데이터를 가로채려해도 거의 복호화가 불가능하다.
- SSL은 클라이언트와 서버간에 핸드셰이크를 통해 인증이 이루어진다. 또한 데이터 무결성을 위해 데이터에 디지털 서명을 하여 데이터가 의도적으로 도착하기 전에 조작된 여부를 확인한다.

## ****TLS/SSL HandShake****

- HTTPS에서 클라이언트와 서버간 통신 전 SSL 인증서로 신뢰성 여부를 판단하기 위해 연결하는 방식
- 클라이언트와 서버간의 메세지 교환이며,  HTTPS 웹에 처음 커넥션할 때 진행된다.
- 핸드셰이크의 단계는 클라이언트와 서버에서 지원하는 암호화 알고리즘, 키 교환 알고리즘에 따라 달라진다. 일반적으로는 RSA 키 교환 알고리즘이 사용된다.

![hs](https://user-images.githubusercontent.com/80567996/198503170-9a1d3847-e19d-4a37-8a25-a38a6c158610.png)

1. 클라이언트는 서버에게 메시지를 담아 서버로 보낸다. 이때 암호화된 정보를 함께 담는데, TLS버전, 암호화 알고리즘, 무작위 바이트 문자열을 담는다.
2. 서버는 또한 응답을 하여 메세지를 전송한다. 서버가 선택한 암호화 방식과 CA 공개 인증서(SSL 인증서), 서버가 순간적으로 생성한 임의의 난수, 클라이언트 인증서 요청(선택 사항)를 메시지와 함께 담아 응답한다. 이 CA 인증서에는 앞으로 통신 이후 사용할 대칭키가 생성되기 전, 클라이언트에서 handshake 과정 속 암호화에 사용할 공개키를 담고 있다.
3. 클라이언트 측은 서버에서 보낸 CA 인증서에 대해 유효한 지 CA 목록에서 확인하는 과정을 진행한다. (인증 발행 기관에 검증한다는 의미, CA(Certificate Authority)가 인증 발행 기관 )
4. CA 인증서에 대한 신뢰성이 확보되었다면, 클라이언트는 난수 바이트를 생성하여 서버의 공개키로 암호화한다. 이 난수 바이트는 대칭키를 정하는데 사용이 되고, 앞으로 서로 메시지를 통신할 때 암호화하는데 사용된다.
5. 만약 2번 단계에서 서버가 클라이언트 인증서를 함께 요구했다면, 클라이언트의 인증서와 클라이언트의 개인키로 암호화된 임의의 바이트 문자열을 함께 보내준다.
6. 서버는 클라이언트의 인증서를 확인 후, 난수 바이트를 자신의 개인키로 복호화 후 대칭 마스터 키 생성에 활용한다.
7. 클라이언트는 handshake 과정이 완료되었다는 finished 메시지를 서버에 보내면서, 지금까지 보낸 교환 내역들을 해싱 후 그 값을 대칭키로 암호화하여 같이 담아 보내준다.
8. 서버도 동일하게 교환 내용들을 해싱한 뒤 클라이언트에서 보내준 값과 일치하는 지 확인한다. 일치하면 서버도 마찬가지로 finished 메시지를 이번에 만든 대칭키로 암호화하여 보낸다.
9. 클라이언트는 해당 메시지를 대칭키로 복호화하여 서로 통신이 가능한 신뢰받은 사용자란 걸 인지하고, 앞으로 클라이언트와 서버는 해당 대칭키로 데이터를 주고받을 수 있게 된다.

### **SSL/TLS 인증서(CA 인증서)**

SSL은 SSL인증서(=TLS인증서)가 있는 웹사이트만 실행할 수 있다. 인증서는 사람의 신분증과 유사하다고 볼 수 있다.

SSL인증서에는 공개 키가 포함된다. 이 공개키 덕분에 암호화가 가능하게 된다. 클라이언트의 요청은 공개 키를 이용해 서버에 암호화 하여 전달한다. 서버에도 공개되지 않는 개인 키가 있는데 이 개인 키를 이용해 암호화된 데이터를 복호화한다.

해당 인증서를 발급하는 기관은 CA(certificate authority)라고 한다.
