# 프로세스 & 스레드

## 프로그램

어떤 작업을 하기 위해 실행할 수 있는 파일 또는 프로그램

## 프로세스

- 프로그램을 메모리 상에서 실행 중인 작업, 메모리에 적재되고 운영체제로부터 CPU 자원을 할당받아 프로그램이 실행되고 있는 작업의 단위
- 기본적으로 프로세스마다 최소 1개의 스레드 소유
- 프로세스는 각각 별도의 주소 공간 할당
    - 원칙적으로 서로 다른 프로세스간의 메모리 공간 접근은 허용되지 않는다. 만약 프로세스간 서로 다른 자원에 접근하려면 프로세스간의 통신을 해야 한다.
    - Code
        - 코드 자체를 구성하는 메모리 영역(프로그램 명령)
        - 함수, 제어문, 상수 등에 대한 기계어 코드가 들어간다
    - Data
        - 전역변수, 정적변수, 배열 등의 초기 값이 있는 변수들이 들어감
    - BSS
        - 초기화 되지 않은 전역변수 데이터가 들어감
    - Heap
        - 동적 할당 시 사용 (new(), malloc() 등)
        - 동적 할당으로 할당된 변수가 들어감
    - Stack:
        - 지역변수, 매개변수, 리턴 값 (임시 메모리 영역)
        - 블록 내에서 할당된 변수가 들어감
        - 호출한 함수가 종료되면 되돌아올 메모리 주소를 스택에 저장하거나 변수 사용 범위에 영향을 미치는 영역을 구현할 때 사용

## 스레드

- 프로세스 안에서 실행되는 여러 흐름 단위, 프로세스가 할당받은 자원을 이용하는 실행의 단위
- 스레드는 Stack만 따로 할당 받고 나머지 영역은 다른 스레드와 서로 공유
- 하나의 프로세스가 생성될 때, 기본적으로 하나의 스레드 같이 생성

## 멀티 태스킹

- OS를 통해 CPU가 작업하는데 필요한 자원(시간)을 프로세스 또는 스레드간에 나누는 행위를 말한다.
- 여러 응용 프로그램을 동시에 열고 작업 할 수 있다

## 멀티프로세스

- 개념
    - 하나의 프로그램을 여러 개의 프로세스로 구성하여 각 프로세스가 병렬적으로 작업을 수행하는 것
    - 두개 이상의 다수 프로세서(cpu)가 협력적으로 하나 이상의 작업을 동시에 병렬 처리하는 것
    - 각 프로세스 간 메모리 구분이 필요하거나 독립된 주소 공간을 가져야 할 경우 사용
- 장점
    - 독립된 구조로 안전성이 높다
    - 프로세스 중 하나에 문제가 생겨도 다른 프로세스에 영향을 주지 않아, 작업속도가 느려지는 손해정도는 생기지만 정지되거나 하는 문제는 발생하지 않는다.
    - 여러 개의 프로세스가 처리되어야 할 때 동일한 데이터를 사용하고, 이러한 데이터를 하나의 디스크에 두고 모든 프로세서(CPU)가 이를 공유하면 비용적으로 저렴하다
- 단점
    - 독립된 메모리 영역이기 때문에 작업량이 많을수록( Context Switching
    이 자주 일어나서 주소 공간의 공유가 잦을 경우) 오버헤드가 발생하여 성능저하가 발생 가능
    - Context Switching과정에서 캐시 메모리 초기화 등 무거운 작업이 진행되고 시간이 소모되는 등 오버헤드가 발생
- Context Switching
    - CPU는 한번에 하나의 프로세스만 실행 가능하며, CPU에서 여러 프로세스를 돌아가면서 작업을 처리하는 데 이 과정을 Context Switching
    - 즉, 동작 중인 프로세스가 대기하면서 해당 프로세스의 상태를 보관하고, 대기하고 있던 다음 순번의 프로세스가 동작하면서 이전에 보관했던 프로세스 상태를 복구하는 과정

## 멀티스레드

- 개념
    - 하나의 프로세스에 여러 스레드로 자원을 공유하며 작업을 나누어 수행하는 것
- 장점
    - 시스템 자원소모 감소 (자원의 효율성 증대)
        - 프로세스를 생성하여 자원을 할당하는 시스템 콜이 줄어 자원을 효율적으로 관리할 수 있다.
    - 시스템 처리율 향상 (처리비용 감소)
        - 스레드 간 데이터를 주고 받는 것이 간단해지고 시스템 자원 소모가 줄어든다.
        - 스레드 사이 작업량이 작아 Context Switching이 빠르다. (캐시 메모리를 비울 필요가 없다.)
    - 간단한 통신 방법으로 프로그램 응답시간 단축
        - 스레드는 프로세스 내 스택 영역을 제외한 메모리 영역을 공유하기에 통신 비용이 적다.
        - 힙 영역을 공유하므로 데이터를 주고 받을 수 있다.
- 단점
    - 자원을 공유하기에 동기화 문제가 발생할 수 있다. (병목현상, 데드락 등)
    - 주의 깊은 설계가 필요하고 디버깅이 어렵다. (불필요 부분까지 동기화하면, 대기시간으로 인해 성능저하 발생)
    - 하나의 스레드에 문제가 생기면 전체 프로세스가 영향을 받는다.
    - 단일 프로세스 시스템의 경우 효과를 기대하기 어렵다.
